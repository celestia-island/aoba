# Single Station - Master Mode - Discrete Inputs (02) Register Type
# Test ID: tui_master_discrete_inputs
# Station: ID=1, Type=Discrete Inputs, Address=0x0000, Length=10

[manifest]
id = "single_station_master_discrete_inputs"
description = "Single station Master mode with Discrete Inputs registers"
station_id = 1
register_type = "DiscreteInputs"
start_address = 0x0000
register_count = 10
is_master = true

# Execution order for initial setup
init_order = [
  "navigate_to_entry",
  "enter_config_panel",
  "navigate_to_business_config",
  "enter_modbus_panel",
  "create_station",
  "configure_station_fields",
  "edit_registers",
  "save_configuration",
  "verify_port_enabled",
]

# Execution order for repeated verification cycles
recycle_order = [
  "reset_registers",
  "edit_registers",
  "save_configuration",
  "verify_mock_data",
]

# Step 1: Navigate to Entry page
[[workflow.navigate_to_entry]]
description = "Initialize mock state for entry page"
mock_path = "$.page"
mock_set_value = { type = "entry" }

[[workflow.navigate_to_entry]]
description = "Ensure entry page port order"
mock_path = "$.port_order"
mock_set_value = ["/tmp/vcom1", "/tmp/vcom2"]

[[workflow.navigate_to_entry]]
description = "Wait for entry screen to populate ports"
sleep_ms = 1500

[[workflow.navigate_to_entry]]
description = "Initial navigation to entry page"
verify = "/tmp/vcom1"
at_line = 2

[[workflow.navigate_to_entry]]
verify = "/tmp/vcom2"
at_line = 3

# Step 2: Enter configuration panel
[[workflow.enter_config_panel]]
description = "Press Enter on selected port to enter config panel"
key = "Enter"

[[workflow.enter_config_panel]]
description = "Switch mock state to config panel"
mock_path = "$.page"
mock_set_value = { type = "config_panel" }

[[workflow.enter_config_panel]]
description = "Set config panel cursor to EnablePort"
mock_path = "$.page_state.config_panel.cursor"
mock_set_value = "EnablePort"

[[workflow.enter_config_panel]]
description = "Wait for config panel to render"
sleep_ms = 1500

[[workflow.enter_config_panel]]
verify = "Enable Port"
at_line = 2

# Step 3: Navigate to business configuration
[[workflow.navigate_to_business_config]]
description = "Navigate down to Business Configuration menu item"
key = "Down"
times = 2

[[workflow.navigate_to_business_config]]
description = "Highlight Business Configuration entry"
mock_path = "$.page_state.config_panel.cursor"
mock_set_value = "ProtocolConfig"

[[workflow.navigate_to_business_config]]
verify = "Enter Business Configuration"
at_line = 4

[[workflow.navigate_to_business_config]]
cursor_at_line = 2

# Step 4: Enter Modbus panel
[[workflow.enter_modbus_panel]]
description = "Press Enter to enter Modbus dashboard"
key = "Enter"

[[workflow.enter_modbus_panel]]
description = "Switch mock state to Modbus dashboard"
mock_path = "$.page"
mock_set_value = { type = "modbus_dashboard" }

[[workflow.enter_modbus_panel]]
description = "Reset Modbus cursor to AddLine"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "AddLine" }

[[workflow.enter_modbus_panel]]
verify = "ModBus Master/Slave Set"
at_line = 0

# Step 5: Create station
[[workflow.create_station]]
description = "Press Enter on 'Create Station' to create new station"
key = "Enter"

[[workflow.create_station]]
description = "Initialize master station structure"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters"
mock_set_value = [
  { station_id = 1, register_type = "DiscreteInputs", start_address = 0, register_count = 10, registers = [
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
  ] },
]

[[workflow.create_station]]
description = "Focus cursor on station header"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "StationId", station_index = 0 }

[[workflow.create_station]]
verify = "#1 - ID: 1"
at_line = 5

[[workflow.create_station]]
description = "Refresh station metadata before field verification"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].station_id"
mock_set_value = 1

[[workflow.create_station]]
verify = "Station ID"
at_line = 6

# Step 6, Row 1: Configure Station ID field
[[workflow.configure_station_fields]]
description = "Row 1 - Navigate to Station ID field"
key = "Down"
times = 1

[[workflow.configure_station_fields]]
description = "Row 1 - Highlight Station ID field"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "StationId", station_index = 0 }

[[workflow.configure_station_fields]]
description = "Row 1 - Enter edit mode for Station ID"
key = "Enter"
sleep_ms = 200

[[workflow.configure_station_fields]]
description = "Row 1 - Clear station ID in mock state"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].station_id"
mock_set_value = 0

[[workflow.configure_station_fields]]
description = "Row 1 - Clear existing value"
key = "Ctrl+a"

[[workflow.configure_station_fields]]
description = "Row 1 - Mirror cleared station ID"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].station_id"
mock_set_value = 0

[[workflow.configure_station_fields]]
description = "Row 1 - Delete cleared content"
key = "Backspace"

[[workflow.configure_station_fields]]
description = "Row 1 - Maintain cleared station ID"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].station_id"
mock_set_value = 0

[[workflow.configure_station_fields]]
description = "Row 1 - Type station ID"
input = "decimal"
value = 1
index = 10

[[workflow.configure_station_fields]]
description = "Row 1 - Confirm Station ID"
key = "Enter"

[[workflow.configure_station_fields]]
description = "Row 1 - Update Station ID in mock state"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].station_id"
mock_set_value = 1

[[workflow.configure_station_fields]]
description = "Row 1 - Wait for field to update"
sleep_ms = 200

# Step 6, Row 2: Configure Register Type field  
[[workflow.configure_station_fields]]
description = "Row 2 - Navigate to Register Type field"
key = "Down"
times = 1

[[workflow.configure_station_fields]]
description = "Row 2 - Highlight Register Type field"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "RegisterMode", station_index = 0 }

[[workflow.configure_station_fields]]
description = "Row 2 - Enter edit mode for Register Type"
key = "Enter"
sleep_ms = 200

[[workflow.configure_station_fields]]
description = "Row 2 - Mirror default register type"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].register_type"
mock_set_value = "Holding"

[[workflow.configure_station_fields]]
description = "Row 2 - Cycle register type to Discrete Inputs"
key = "Left"
times = 1
sleep_ms = 200

[[workflow.configure_station_fields]]
description = "Row 2 - Apply Discrete Inputs in mock state"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].register_type"
mock_set_value = "DiscreteInputs"

[[workflow.configure_station_fields]]
description = "Row 2 - Confirm Register Type"
key = "Enter"

[[workflow.configure_station_fields]]
description = "Row 2 - Wait for field to update"
sleep_ms = 200

# Step 6, Row 3: Configure Start Address field
[[workflow.configure_station_fields]]
description = "Row 3 - Navigate to Start Address field"
key = "Down"
times = 1

[[workflow.configure_station_fields]]
description = "Row 3 - Highlight Start Address field"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "RegisterStartAddress", station_index = 0 }

[[workflow.configure_station_fields]]
description = "Row 3 - Enter edit mode for Start Address"
key = "Enter"
sleep_ms = 200

[[workflow.configure_station_fields]]
description = "Row 3 - Reset start address in mock state"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].start_address"
mock_set_value = 0

[[workflow.configure_station_fields]]
description = "Row 3 - Clear existing value"
key = "Ctrl+a"

[[workflow.configure_station_fields]]
description = "Row 3 - Mirror cleared start address"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].start_address"
mock_set_value = 0

[[workflow.configure_station_fields]]
description = "Row 3 - Delete cleared content"
key = "Backspace"

[[workflow.configure_station_fields]]
description = "Row 3 - Maintain cleared start address"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].start_address"
mock_set_value = 0

[[workflow.configure_station_fields]]
description = "Row 3 - Type start address"
input = "hex"
value = 0x0000
index = 11
sleep_ms = 200

[[workflow.configure_station_fields]]
description = "Row 3 - Confirm Start Address"
key = "Enter"

[[workflow.configure_station_fields]]
description = "Row 3 - Update Start Address in mock state"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].start_address"
mock_set_value = 0

[[workflow.configure_station_fields]]
description = "Row 3 - Wait for field to update"
sleep_ms = 200

# Step 6, Row 4: Configure Register Count field
[[workflow.configure_station_fields]]
description = "Row 4 - Navigate to Register Count field"
key = "Down"
times = 1

[[workflow.configure_station_fields]]
description = "Row 4 - Highlight Register Count field"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "RegisterLength", station_index = 0 }

[[workflow.configure_station_fields]]
description = "Row 4 - Enter edit mode for Register Count"
key = "Enter"
sleep_ms = 200

[[workflow.configure_station_fields]]
description = "Row 4 - Reset register count in mock state"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].register_count"
mock_set_value = 0

[[workflow.configure_station_fields]]
description = "Row 4 - Clear existing value"
key = "Ctrl+a"

[[workflow.configure_station_fields]]
description = "Row 4 - Mirror cleared register count"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].register_count"
mock_set_value = 0

[[workflow.configure_station_fields]]
description = "Row 4 - Delete cleared content"
key = "Backspace"

[[workflow.configure_station_fields]]
description = "Row 4 - Maintain cleared register count"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].register_count"
mock_set_value = 0

[[workflow.configure_station_fields]]
description = "Row 4 - Type register count"
input = "decimal"
value = 10
index = 12
sleep_ms = 200

[[workflow.configure_station_fields]]
description = "Row 4 - Confirm Register Count"
key = "Enter"

[[workflow.configure_station_fields]]
description = "Row 4 - Update Register Count in mock state"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].register_count"
mock_set_value = 10

[[workflow.configure_station_fields]]
description = "Row 4 - Ensure registers array matches length"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].registers"
mock_set_value = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

[[workflow.configure_station_fields]]
description = "Row 4 - Wait for register grid to appear"
sleep_ms = 1000

# Step 7, Register 0: Edit first register (index 0)
[[workflow.edit_registers]]
description = "Register 0 - Enter edit mode"
key = "Enter"
sleep_ms = 200

[[workflow.edit_registers]]
description = "Register 0 - Focus register cursor"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 0 }

[[workflow.edit_registers]]
description = "Register 0 - Store input value in placeholder"
input_register = { pool = "bool", index = 0, format = "one_zero" }
index = 0
sleep_ms = 200

[[workflow.edit_registers]]
description = "Register 0 - Confirm edit"
key = "Enter"

[[workflow.edit_registers]]
description = "Register 0 - Update mock state"
mock_sync_value = { path = "$.ports['/tmp/vcom1'].modbus_masters[0].registers[0]", pool = "bool", index = 0 }

[[workflow.edit_registers]]
description = "Register 0 - Verify display format"
verify = "ON   OFF  OFF  OFF"
at_line = 10
press_if = { pool = "bool", index = 0, equals = 1 }

[[workflow.edit_registers]]
description = "Register 0 - Move to next register"
key = "Right"

[[workflow.edit_registers]]
description = "Register 0 - Highlight next register"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 1 }

# Step 7, Register 1: Edit second register (index 1)
[[workflow.edit_registers]]
description = "Register 1 - Enter edit mode"
key = "Enter"
sleep_ms = 200

[[workflow.edit_registers]]
description = "Register 1 - Focus register cursor"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 1 }

[[workflow.edit_registers]]
description = "Register 1 - Store input value in placeholder"
input_register = { pool = "bool", index = 1, format = "one_zero" }
index = 1

[[workflow.edit_registers]]
description = "Register 1 - Confirm edit"
key = "Enter"

[[workflow.edit_registers]]
description = "Register 1 - Update mock state"
mock_sync_value = { path = "$.ports['/tmp/vcom1'].modbus_masters[0].registers[1]", pool = "bool", index = 1 }

[[workflow.edit_registers]]
description = "Register 1 - Verify display format"
verify = "ON   OFF  OFF  OFF"
at_line = 10

[[workflow.edit_registers]]
description = "Register 1 - Conditional OFF indicator"
press_if = { pool = "bool", index = 1, equals = 0 }
verify = "OFF"
at_line = 10

[[workflow.edit_registers]]
description = "Register 1 - Move to next register"
key = "Right"

[[workflow.edit_registers]]
description = "Register 1 - Highlight next register"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 2 }

# Step 7, Register 2: Edit third register (index 2)
[[workflow.edit_registers]]
description = "Register 2 - Enter edit mode"
key = "Enter"
sleep_ms = 200

[[workflow.edit_registers]]
description = "Register 2 - Focus register cursor"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 2 }

[[workflow.edit_registers]]
description = "Register 2 - Store input value in placeholder"
input_register = { pool = "bool", index = 2, format = "one_zero" }
index = 2

[[workflow.edit_registers]]
description = "Register 2 - Confirm edit"
key = "Enter"

[[workflow.edit_registers]]
description = "Register 2 - Update mock state"
mock_sync_value = { path = "$.ports['/tmp/vcom1'].modbus_masters[0].registers[2]", pool = "bool", index = 2 }

[[workflow.edit_registers]]
description = "Register 2 - Verify display format"
verify = "ON   OFF  ON   OFF"
at_line = 10

[[workflow.edit_registers]]
description = "Register 2 - Move to next register"
key = "Right"

[[workflow.edit_registers]]
description = "Register 2 - Highlight next register"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 3 }

# Step 7, Register 3: Edit fourth register (index 3)
[[workflow.edit_registers]]
description = "Register 3 - Enter edit mode"
key = "Enter"
sleep_ms = 200

[[workflow.edit_registers]]
description = "Register 3 - Focus register cursor"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 3 }

[[workflow.edit_registers]]
description = "Register 3 - Store input value in placeholder"
input_register = { pool = "bool", index = 3, format = "one_zero" }
index = 3

[[workflow.edit_registers]]
description = "Register 3 - Confirm edit"
key = "Enter"

[[workflow.edit_registers]]
description = "Register 3 - Update mock state"
mock_sync_value = { path = "$.ports['/tmp/vcom1'].modbus_masters[0].registers[3]", pool = "bool", index = 3 }

[[workflow.edit_registers]]
description = "Register 3 - Verify display format"
verify = "ON   OFF  ON   OFF"
at_line = 10

[[workflow.edit_registers]]
description = "Register 3 - Move to next register"
key = "Right"

[[workflow.edit_registers]]
description = "Register 3 - Highlight next register"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 4 }

# Step 7, Register 4: Edit fifth register (index 4)
[[workflow.edit_registers]]
description = "Register 4 - Enter edit mode"
key = "Enter"
sleep_ms = 200

[[workflow.edit_registers]]
description = "Register 4 - Focus register cursor"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 4 }

[[workflow.edit_registers]]
description = "Register 4 - Store input value in placeholder"
input_register = { pool = "bool", index = 4, format = "one_zero" }
index = 4

[[workflow.edit_registers]]
description = "Register 4 - Confirm edit"
key = "Enter"

[[workflow.edit_registers]]
description = "Register 4 - Update mock state"
mock_sync_value = { path = "$.ports['/tmp/vcom1'].modbus_masters[0].registers[4]", pool = "bool", index = 4 }

[[workflow.edit_registers]]
description = "Register 4 - Verify display format"
verify = "ON   OFF  OFF  OFF"
at_line = 11

[[workflow.edit_registers]]
description = "Register 4 - Move to next register"
key = "Right"

[[workflow.edit_registers]]
description = "Register 4 - Highlight next register"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 5 }

# Step 7, Register 5: Edit sixth register (index 5)
[[workflow.edit_registers]]
description = "Register 5 - Enter edit mode"
key = "Enter"
sleep_ms = 200

[[workflow.edit_registers]]
description = "Register 5 - Focus register cursor"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 5 }

[[workflow.edit_registers]]
description = "Register 5 - Store input value in placeholder"
input_register = { pool = "bool", index = 5, format = "one_zero" }
index = 5

[[workflow.edit_registers]]
description = "Register 5 - Confirm edit"
key = "Enter"

[[workflow.edit_registers]]
description = "Register 5 - Update mock state"
mock_sync_value = { path = "$.ports['/tmp/vcom1'].modbus_masters[0].registers[5]", pool = "bool", index = 5 }

[[workflow.edit_registers]]
description = "Register 5 - Verify display format"
verify = "ON   OFF  OFF  OFF"
at_line = 11

[[workflow.edit_registers]]
description = "Register 5 - Move to next register"
key = "Right"

[[workflow.edit_registers]]
description = "Register 5 - Highlight next register"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 6 }

# Step 7, Register 6: Edit seventh register (index 6)
[[workflow.edit_registers]]
description = "Register 6 - Enter edit mode"
key = "Enter"
sleep_ms = 200

[[workflow.edit_registers]]
description = "Register 6 - Focus register cursor"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 6 }

[[workflow.edit_registers]]
description = "Register 6 - Store input value in placeholder"
input_register = { pool = "bool", index = 6, format = "one_zero" }
index = 6

[[workflow.edit_registers]]
description = "Register 6 - Confirm edit"
key = "Enter"

[[workflow.edit_registers]]
description = "Register 6 - Update mock state"
mock_sync_value = { path = "$.ports['/tmp/vcom1'].modbus_masters[0].registers[6]", pool = "bool", index = 6 }

[[workflow.edit_registers]]
description = "Register 6 - Verify display format"
verify = "ON   OFF  ON   OFF"
at_line = 11

[[workflow.edit_registers]]
description = "Register 6 - Move to next register"
key = "Right"

[[workflow.edit_registers]]
description = "Register 6 - Highlight next register"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 7 }

# Step 7, Register 7: Edit eighth register (index 7)
[[workflow.edit_registers]]
description = "Register 7 - Enter edit mode"
key = "Enter"
sleep_ms = 200

[[workflow.edit_registers]]
description = "Register 7 - Focus register cursor"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 7 }

[[workflow.edit_registers]]
description = "Register 7 - Store input value in placeholder"
input_register = { pool = "bool", index = 7, format = "one_zero" }
index = 7

[[workflow.edit_registers]]
description = "Register 7 - Confirm edit"
key = "Enter"

[[workflow.edit_registers]]
description = "Register 7 - Update mock state"
mock_sync_value = { path = "$.ports['/tmp/vcom1'].modbus_masters[0].registers[7]", pool = "bool", index = 7 }

[[workflow.edit_registers]]
description = "Register 7 - Verify display format"
verify = "ON   OFF  ON   OFF"
at_line = 11

[[workflow.edit_registers]]
description = "Register 7 - Move to next register"
key = "Right"

[[workflow.edit_registers]]
description = "Register 7 - Highlight next register"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 8 }

# Step 7, Register 8: Edit ninth register (index 8)
[[workflow.edit_registers]]
description = "Register 8 - Enter edit mode"
key = "Enter"
sleep_ms = 200

[[workflow.edit_registers]]
description = "Register 8 - Focus register cursor"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 8 }

[[workflow.edit_registers]]
description = "Register 8 - Store input value in placeholder"
input_register = { pool = "bool", index = 8, format = "one_zero" }
index = 8

[[workflow.edit_registers]]
description = "Register 8 - Confirm edit"
key = "Enter"

[[workflow.edit_registers]]
description = "Register 8 - Update mock state"
mock_sync_value = { path = "$.ports['/tmp/vcom1'].modbus_masters[0].registers[8]", pool = "bool", index = 8 }

[[workflow.edit_registers]]
description = "Register 8 - Verify display format"
verify = "ON   OFF  ____ ____"
at_line = 12

[[workflow.edit_registers]]
description = "Register 8 - Move to next register"
key = "Right"

[[workflow.edit_registers]]
description = "Register 8 - Highlight next register"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 9 }

# Step 7, Register 9: Edit tenth register (index 9)
[[workflow.edit_registers]]
description = "Register 9 - Enter edit mode"
key = "Enter"
sleep_ms = 200

[[workflow.edit_registers]]
description = "Register 9 - Focus register cursor"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "Register", station_index = 0, register_index = 9 }

[[workflow.edit_registers]]
description = "Register 9 - Store input value in placeholder"
input_register = { pool = "bool", index = 9, format = "one_zero" }
index = 9

[[workflow.edit_registers]]
description = "Register 9 - Confirm edit"
key = "Enter"

[[workflow.edit_registers]]
description = "Register 9 - Update mock state"
mock_sync_value = { path = "$.ports['/tmp/vcom1'].modbus_masters[0].registers[9]", pool = "bool", index = 9 }

[[workflow.edit_registers]]
description = "Register 9 - Verify display format"
verify = "ON   OFF  ____ ____"
at_line = 12

[[workflow.edit_registers]]
description = "Register 9 - Return to top of panel"
key = "Ctrl+PageUp"

[[workflow.edit_registers]]
description = "Register 9 - Reset cursor to station header"
mock_path = "$.page_state.modbus_dashboard.cursor"
mock_set_value = { kind = "StationId", station_index = 0 }

# Step 8.5: Reset registers for recycle (recycle_order only)
[[workflow.reset_registers]]
description = "Restore register grid to cleared state before recycle"
mock_path = "$.ports['/tmp/vcom1'].modbus_masters[0].registers"
mock_set_value = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

[[workflow.reset_registers]]
description = "Reveal cleared register row on screen"
verify = "0x0000              OFF  OFF  OFF  OFF"
at_line = 10

# Step 8: Save configuration
[[workflow.save_configuration]]
description = "Save configuration with Ctrl+S"
key = "Ctrl+s"

[[workflow.save_configuration]]
description = "Enable port in mock state"
mock_path = "$.ports['/tmp/vcom1'].enabled"
mock_set_value = true

[[workflow.save_configuration]]
description = "Set port state to OccupiedByThis"
mock_path = "$.ports['/tmp/vcom1'].state"
mock_set_value = { type = "occupied_by_this" }

[[workflow.save_configuration]]
description = "Wait for port to enable and stabilize"
sleep_ms = 5000

[[workflow.save_configuration]]
description = "Expose running indicator state in mock data"
mock_path = "$.ports['/tmp/vcom1'].enabled"
mock_set_value = true

[[workflow.save_configuration]]
description = "Verify Running status indicator"
verify = "Running ‚óè"
at_line = 0

# Step 9: Verify port enabled
[[workflow.verify_port_enabled]]
description = "Check port is enabled in status"
mock_verify_path = "$.ports['/tmp/vcom1'].enabled"
mock_verify_value = true

[[workflow.verify_port_enabled]]
description = "Check port state is Running"
mock_verify_path = "$.ports['/tmp/vcom1'].state"
mock_verify_value = { type = "occupied_by_this" }

# Step 10: Verify mock data (used in recycle)
[[workflow.verify_mock_data]]
description = "Verify all register values in mock state"
mock_verify_path = "$.ports['/tmp/vcom1'].modbus_masters[0].register_count"
mock_verify_value = 10

[[workflow.verify_mock_data]]
description = "Verify station configuration"
mock_verify_path = "$.ports['/tmp/vcom1'].modbus_masters[0].station_id"
mock_verify_value = 1

[[workflow.verify_mock_data]]
description = "Verify register type is Discrete Inputs"
mock_verify_path = "$.ports['/tmp/vcom1'].modbus_masters[0].register_type"
mock_verify_value = "DiscreteInputs"
